# MLM
**M**ulti **L**evel **M**igration is a pipeline for ancestral status inference of nodes from phylogeographic analysis, proudly introduced by Naclist.

## Table of Contents
1. [Installation](#installation)
2. [Dependencies](#dependencies)
3. [Usage](#usage)
    - [MLM Usage](#mlm-usage)
    - [Treetime Mugration Usage](#treetime-migration-inference)
---

## Installation

To use MLM.py, you need to have Python 3.x installed. The script relies on several third-party packages, which can be installed using `pip`.

Clone the repository:
```bash
git clone git@github.com:Naclist/MLM.git
```
or
```bash
git clone https://github.com/Naclist/MLM.git
```
---

## Dependencies

The following Python packages are required to run `MLM.py`:

- `biopython`: For working with phylogenetic trees (Newick format).
- `pandas`: For handling confidence matrices in tabular format.
- `treetime`: For applying the Treetime migration model.
- `numpy` (optional, for numerical operations).

Install the dependencies with:

```bash
pip install biopython pandas treetime numpy
```
---
## Usage
---
### MLM usage
`MLM.py` is used to process a Newick format tree, read a trait file (processed from TreeTime's `.nex` file), and a confidence matrix generated from TreeTime's migration model. It calculates node weights, assigns geographical regions to nodes, and computes spread probabilities based on the tree structure and region-specific data.

#### Command-Line Usage

1. Prepare your files
   - `Tree`: Your phylogenetic tree in Newick format.
   - `Trait`: A trait file generated by parsing TreeTime's annotated `.nex` file using `parse_annotated_nexus.py`. This file contains meta-information about the tree nodes.
   - `Confidence.mat`: The confidence matrix file generated by `TreeTime mugration`. This is a CSV file with confidence values for each node in each region.

2. Run MLM.py:
```bash
python MLM.py [Tree] [Trait] [Confidence.mat]
```
This will process the tree, trait, and confidence matrix to compute the node weights and spread probabilities.

---

### TreeTime Migration Inference
TreeTime is used to perform migration analysis, and its output is required for MLM.py to function. Hereâ€™s how to use TreeTime to generate the necessary files.
1. Run TreeTime Migration:
Run TreeTime to generate the migration output. This includes the `.nex` file (which is later parsed by `parse_annotated_nexus.py`) and the confidence matrix CSV file.
Example:
```bash
treetime --tree input_tree.nwk --states metadata.csv --attribute country --confidence
```
2. Parse the Nexus File:
Use `parse_annotated_nexus.py` to parse the `.nex` file into a trait file.
Example:
```bash
python parse_annotated_nexus.py time_meta.nex
```
This will generate the `trait.meta` file that you can then use as input for `MLM.py`.

